<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The implementation of the forward vector accelerated candidate finder."><title>find in memchr::memmem::prefilter::genericsimd - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="memchr" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0 (051478957 2024-07-21)" data-channel="1.80.0" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../memchr/index.html">memchr</a><span class="version">2.5.0</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In memchr::memmem::prefilter::genericsimd</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../../../index.html">memchr</a>::<wbr><a href="../../index.html">memmem</a>::<wbr><a href="../index.html">prefilter</a>::<wbr><a href="index.html">genericsimd</a>::<wbr><a class="fn" href="#">find</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../../src/memchr/memmem/prefilter/genericsimd.rs.html#44-93">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub(crate) unsafe fn find&lt;V: <a class="trait" href="../../vector/trait.Vector.html" title="trait memchr::memmem::vector::Vector">Vector</a>&gt;(
    prestate: &amp;mut <a class="struct" href="../struct.PrefilterState.html" title="struct memchr::memmem::prefilter::PrefilterState">PrefilterState</a>,
    ninfo: &amp;<a class="struct" href="../../struct.NeedleInfo.html" title="struct memchr::memmem::NeedleInfo">NeedleInfo</a>,
    haystack: &amp;[<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.u8.html">u8</a>],
    needle: &amp;[<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.u8.html">u8</a>],
    fallback: unsafe <a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.fn.html">fn</a>(prestate: &amp;mut <a class="struct" href="../struct.PrefilterState.html" title="struct memchr::memmem::prefilter::PrefilterState">PrefilterState</a>, ninfo: &amp;<a class="struct" href="../../struct.NeedleInfo.html" title="struct memchr::memmem::NeedleInfo">NeedleInfo</a>, haystack: &amp;[<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.u8.html">u8</a>], needle: &amp;[<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.u8.html">u8</a>]) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.usize.html">usize</a>&gt;,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.80.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.80.0/std/primitive.usize.html">usize</a>&gt;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The implementation of the forward vector accelerated candidate finder.</p>
<p>This is inspired by the “generic SIMD” algorithm described here:
http://0x80.pl/articles/simd-strfind.html#algorithm-1-generic-simd</p>
<p>The main difference is that this is just a prefilter. That is, it reports
candidates once they are seen and doesn’t attempt to confirm them. Also,
the bytes this routine uses to check for candidates are selected based on
an a priori background frequency distribution. This means that on most
haystacks, this will on average spend more time in vectorized code than you
would if you just selected the first and last bytes of the needle.</p>
<p>Note that a non-prefilter variant of this algorithm can be found in the
parent module, but it only works on smaller needles.</p>
<p><code>prestate</code>, <code>ninfo</code>, <code>haystack</code> and <code>needle</code> are the four prefilter
function parameters. <code>fallback</code> is a prefilter that is used if the haystack
is too small to be handled with the given vector size.</p>
<p>This routine is not safe because it is intended for callers to specialize
this with a particular vector (e.g., __m256i) and then call it with the
relevant target feature (e.g., avx2) enabled.</p>
<h2 id="panics"><a class="doc-anchor" href="#panics">§</a>Panics</h2>
<p>If <code>needle.len() &lt;= 1</code>, then this panics.</p>
<h2 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h2>
<p>Since this is meant to be used with vector functions, callers need to
specialize this inside of a function with a <code>target_feature</code> attribute.
Therefore, callers must ensure that whatever target feature is being used
supports the vector functions that this function is specialized for. (For
the specific vector functions used, see the Vector trait implementations.)</p>
</div></details></section></div></main></body></html>